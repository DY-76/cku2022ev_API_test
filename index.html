<!DOCTYPE html>
<html lang="kr">
<head>
    <meta charset="UTF-8">
    <title>cku2022ev</title>

    <!--    Kakao API-->
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=e22cdd82c10efbbd5945b45ce7749553"></script>

    <script>
        function Request(){
            var serviceKey = 'Zxc%2BL1BY7vTH4mkcjzGShFsue5yUAk2q55yjb3nUf7EeeXcsQTv9nE7qIjVN2oU01PuQMJ%2BiHQGuo2fa2ZlJlw%3D%3D'
            var page_value = document.getElementById('page').value;
            var perPage_value = document.getElementById('perPage').value;
            //var returnType_value = document.getElementById('returnType').value;
            var addr_value = document.getElementById('addr').value;

            var xhr = new XMLHttpRequest();
            var url = 'https://api.odcloud.kr/api/EvInfoServiceV2/v1/getEvSearchList'; /*URL*/
            var queryParams = '?' + encodeURIComponent('page') + '='+ encodeURIComponent(page_value); /*페이지*/
            queryParams += '&' + encodeURIComponent('perPage') + '=' + encodeURIComponent(perPage_value); /*페이지당 데이터 수*/
            queryParams += '&' + encodeURIComponent('returnType') + '=' + encodeURIComponent('JSON'); /*응답 확장자*/
            queryParams += '&' + encodeURIComponent('cond[addr::LIKE]') + '=' + encodeURIComponent(addr_value); /*주소*/
            queryParams += '&' + encodeURIComponent('serviceKey') + '=' + serviceKey; /*Service Key*/
            xhr.open('GET', url + queryParams); /*Get 방식으로 API 호출*/
            xhr.onreadystatechange = function () {
                if (this.readyState === 4) {
                    /*알림창 제공*/
                    alert('Status: '+this.status+'nHeaders: '+JSON.stringify(this.getAllResponseHeaders())+'nBody: '+this.responseText);
                    console.log(this.response['data'][0])
                    console.log(this.response['data'][0]['addr'])
                    console.log(this.response['data'][0]['lat'])
                }
            };
            xhr.send('');
        }
    </script>
</head>
<body>
테스트 페이지
<br>
<br><input type="number" name="page" min="1" max="99" id="page"><span class="up">페이지</span>
<br><input type="number" name="perPage" min="1" max="99" id="perPage"><span class="up">페이지당 표시 자료 수</span>

<br><input type="radio" name="type" checked><span class="up">응답타입 : JSON</span>

<br><input type="text" name="addr" id="addr"><span class="up">주소</span>

<br>
<br><button onclick="Request()">API 호출</button>

<br>
<div id="map" style="width:100%;height:350px;"></div>
<p>
    <button onclick="hideMarkers()">마커 감추기</button>
    <button onclick="showMarkers()">마커 보이기</button>
</p>
<script>
    var container = document.getElementById('map'); //지도를 담을 영역의 DOM 레퍼런스
    var options = { //지도를 생성할 때 필요한 기본 옵션
	    center: new kakao.maps.LatLng(33.450701, 126.570667), //지도의 중심좌표.
	    level: 3 //지도의 레벨(확대, 축소 정도)
    };

    var map = new kakao.maps.Map(container, options); //지도 생성 및 객체 리턴

    // 지도를 클릭했을때 클릭한 위치에 마커를 추가하도록 지도에 클릭이벤트를 등록합니다
    kakao.maps.event.addListener(map, 'click', function(mouseEvent) {
        // 클릭한 위치에 마커를 표시합니다
        addMarker(mouseEvent.latLng);
    });


    // 지도에 표시된 마커 객체를 가지고 있을 배열입니다
    var markers = [];

    // 마커 하나를 지도위에 표시합니다
    addMarker(new kakao.maps.LatLng(33.450701, 126.570667));

    // 마커를 생성하고 지도위에 표시하는 함수입니다
    function addMarker(position) {

        // 마커를 생성합니다
        var marker = new kakao.maps.Marker({
            position: position
        });

        // 마커가 지도 위에 표시되도록 설정합니다
        marker.setMap(map);

        // 생성된 마커를 배열에 추가합니다
        markers.push(marker);
    }

    // 배열에 추가된 마커들을 지도에 표시하거나 삭제하는 함수입니다
    function setMarkers(map) {
        for (var i = 0; i < markers.length; i++) {
            markers[i].setMap(map);
        }
    }

    // "마커 보이기" 버튼을 클릭하면 호출되어 배열에 추가된 마커를 지도에 표시하는 함수입니다
    function showMarkers() {
        setMarkers(map)
    }

    // "마커 감추기" 버튼을 클릭하면 호출되어 배열에 추가된 마커를 지도에서 삭제하는 함수입니다
    function hideMarkers() {
        setMarkers(null);
    }
</script>

</body>
</html>